<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Edit Profile</title>
<link rel="stylesheet" href="style.css">

<style>
    .pwd-wrap { position: relative; }

    .eye-icon {
        width: 20px;
        height: 20px;
        position: absolute;
        right: 14px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        opacity: 0;
        transition: 0.2s;
        pointer-events: none;
    }

    .eye-icon.visible {
        opacity: 0.7;
        pointer-events: auto;
    }

    .eye-icon.visible:hover {
        opacity: 1;
    }
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
    <div class="nav-title">My List</div>

    <div class="nav-center">
        <a href="tasks.html" class="nav-link">Tasks</a>
        <a href="analytics.html" class="nav-link">Analytics</a>
        <a href="contact.html" class="nav-link">Contact</a>
        <a href="about.html" class="nav-link">About</a>
    </div>

    <button class="profile-btn" onclick="location.href='profile.html'">
        <span id="navAvatarEmoji">ğŸ‘¤</span>
    </button>
</nav>


<div class="page-container">
    <div class="card">

        <h2 style="text-align:center;color:#3b2f73;margin-bottom:14px;">Edit Profile</h2>

        <!-- ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ -->
        <div class="profile-avatar-big" id="editAvatar"></div>

        <div style="text-align:center;margin-bottom:16px;">
            <label class="profile-upload-btn">
                ğŸ“· Change Image
                <input type="file" id="editImageInput" accept="image/*" style="display:none;">
            </label>
        </div>

        <!-- FORM -->
        <label>Full Name</label>
        <input type="text" id="editName" class="input-field">

        <label>Email</label>
        <input type="email" id="editEmail" class="input-field" disabled 
               style="opacity:0.6;cursor:not-allowed;">

        <label>Date of Birth</label>
        <input type="date" id="editBirth" class="input-field">

        <label>Gender</label>
        <select id="editGender" class="input-field">
            <option value="other">Other</option>
            <option value="female">Female</option>
            <option value="male">Male</option>
        </select>

        <label>New Password (optional)</label>
        <div class="pwd-wrap">
            <input type="password" id="editPass" class="input-field pwd-field">
 
            <svg class="eye-icon" onclick="togglePwd(this)" viewBox="0 0 24 24">
    <path class="eye-shape" fill="none" stroke="#6a5ea0" stroke-width="2" stroke-linecap="round"
          d="M3 12 C 7 6, 17 6, 21 12" />
    <circle class="eye-ball" cx="12" cy="12" r="3" fill="none" stroke="#6a5ea0" stroke-width="2" />
    <path class="eye-line" fill="none" stroke="#6a5ea0" stroke-width="2" stroke-linecap="round"
          d="M5 5 L19 19" />
</svg>





        </div>

        <label>Confirm New Password</label>
        <div class="pwd-wrap">
            <input type="password" id="editPass2" class="input-field pwd-field">

 <svg class="eye-icon" onclick="togglePwd(this)" viewBox="0 0 24 24">
    <path class="eye-shape" fill="none" stroke="#6a5ea0" stroke-width="2" stroke-linecap="round"
          d="M3 12 C 7 6, 17 6, 21 12" />
    <circle class="eye-ball" cx="12" cy="12" r="3" fill="none" stroke="#6a5ea0" stroke-width="2" />
    <path class="eye-line" fill="none" stroke="#6a5ea0" stroke-width="2" stroke-linecap="round"
          d="M5 5 L19 19" />
</svg>






        </div>

        <button class="btn-primary full-btn" onclick="saveProfileChanges()" style="margin-top:10px;">
            Save Changes
        </button>

    </div>
</div>

<script src="app.js"></script>

<script>

function togglePwd(eyeEl) {
    const input = eyeEl.parentElement.querySelector("input");
    const line = eyeEl.querySelector(".eye-line"); // Ø®Ø· Ø§Ù„Ø¥ØºÙ„Ø§Ù‚

    if (input.type === "password") {
        input.type = "text";
        line.style.display = "none"; // Ø´ÙŠÙ„ Ø§Ù„Ø®Ø· â†’ Ø¹ÙŠÙ† Ù…ÙØªÙˆØ­Ø©
    } else {
        input.type = "password";
        line.style.display = "block"; // Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ø®Ø· â†’ Ø¹ÙŠÙ† Ù…ØºÙ„Ù‚Ø©
    }

    input.focus(); 
}






/* Ø¹ÙŠÙ† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
document.querySelectorAll(".pwd-field").forEach(field => {
    const eye = field.parentElement.querySelector(".eye-icon");

    field.addEventListener("input", () => {
        eye.classList.toggle("visible", field.value.length > 0);
    });

    field.addEventListener("focus", () => {
        if (field.value.length > 0) eye.classList.add("visible");
    });

    field.addEventListener("blur", () => {
        if (field.value.trim() === "") {
            eye.classList.remove("visible");
        }
        // Ø¥Ø°Ø§ ÙÙŠ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±ØŒ Ù†Ø®Ù„ÙŠ Ø§Ù„Ø¹ÙŠÙ† Ø¸Ø§Ù‡Ø±Ø©
    });
});




/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
loadCurrentUserData();
updateNavbarAvatar();

const user = currentUser;
if (user) {
    document.getElementById("editName").value = user.name || "";
    document.getElementById("editEmail").value = user.email || "";
    document.getElementById("editBirth").value = user.birth || "";
    document.getElementById("editGender").value = user.gender || "other";

    const avatar = document.getElementById("editAvatar");
    if (user.imageData) {
        avatar.innerHTML = `<img src="${user.imageData}">`;
    } else {
        let emoji = "ğŸ‘¤";
        if (user.gender === "female") emoji = "ğŸ‘©";
        if (user.gender === "male") emoji = "ğŸ‘¨";
        avatar.innerHTML = `<span>${emoji}</span>`;
    }
}

/* ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© */
document.getElementById("editImageInput").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = ev => {
        currentUser.imageData = ev.target.result;
        document.getElementById("editAvatar").innerHTML =
            `<img src="${currentUser.imageData}">`;
    };
    reader.readAsDataURL(file);
});
function saveProfileChanges() {
            const name = document.getElementById("editName").value.trim();
            const birth = document.getElementById("editBirth").value;
            const gender = document.getElementById("editGender").value;
            const pass = document.getElementById("editPass").value;
            const pass2 = document.getElementById("editPass2").value;

            if (!name) {
                showAlert("Name is required", "#d93025");
                return;
            }

            if (pass || pass2) {
                if (pass.length < 6) {
                    showAlert("New password must be at least 6 characters", "#d93025");
                    return;
                }
                if (pass !== pass2) {
                    showAlert("Passwords do not match", "#d93025");
                    return;
                }
                currentUser.password = pass;
            }

            currentUser.name = name;
            currentUser.birth = birth;
            currentUser.gender = gender;

            saveCurrentUserData();
            updateNavbarAvatar();
            showAlert("Profile updated!", "#4CAF50");

            setTimeout(() => {
                window.location.href = "profile.html";
            }, 1200);
        }
</script>
</body>
</html>
